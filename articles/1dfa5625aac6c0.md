---
title: "DeviseInvitableでユーザー招待機能を簡単に実装する"
emoji: "🐈"
type: "tech" 
topics: ["Rails"]
published: false
---

Deviseを使用しているRailsアプリにユーザー招待機能を実装できる[DeviseInvitable](https://github.com/scambra/devise_invitable)を最近使ったのでそのメモです。

## [DeviseInvitable](https://github.com/scambra/devise_invitable)の紹介

[Devise](https://github.com/heartcombo/devise)に対して、ユーザー招待機能を追加できるGemです。

https://github.com/scambra/devise_invitable

招待の流れは以下のようになります。

1. 管理者などがフォームか招待したいユーザーのEmailアドレスを入力して送信
1. Emailアドレス宛に招待リンク付きのメールが届き、リンクをクリックするとパスワード設定フォームが開く
1. フォームでパスワードを設定して送信するとログイン状態となる

## 前提

既にDeviseがインストールされているRailsアプリを想定しています。以下の環境で動作確認をしました。

- Rails 6.1.4
- Ruby 2.7.3
- devise 4.8.0
- devise_invitable 2.0.5


## セットアップの流れ

**Gemを追加**

以下を追加して、`bundle install`します。

```rb:Gemfile
gem 'devise_invitable'
```

**設定ファイル、カラム群を作成**

下記を実行します。`devise.rb`に招待関係のオプションのコメントが入るのと、`config/locales/devise_invitable.en.yml`が作成されます。

```shell
rails generate devise_invitable:install
```

続いて、DeviseInvitableをモデルに紐付けしていきます。

```shell
rails generate devise_invitable User # モデル名
```

Migrationファイルが作成されるので、`rails db:migrate`を実行しましょう。

**viewの作成**

ユーザー招待用のViewファイルを作成します。この時作成されるViewは以下です。

- `app/views/devise/invitations/new.html.erb`: ユーザー招待画面
- `app/views/devise/invitations/edit.html.erb`: ユーザーがパスワードを設定する画面

```shell
rails generate devise_invitable:views
```

