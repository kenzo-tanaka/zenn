---
title: "DeviseInvitableã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…æ©Ÿèƒ½ã‚’ç°¡å˜ã«å®Ÿè£…ã™ã‚‹"
emoji: "ğŸˆ"
type: "tech" 
topics: ["Rails"]
published: false
---

Deviseã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹Railsã‚¢ãƒ—ãƒªã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…æ©Ÿèƒ½ã‚’å®Ÿè£…ã§ãã‚‹[DeviseInvitable](https://github.com/scambra/devise_invitable)ã‚’æœ€è¿‘ä½¿ã£ãŸã®ã§ãã®å®Ÿè£…ãƒ¡ãƒ¢ã§ã™ã€‚

## [DeviseInvitable](https://github.com/scambra/devise_invitable)ã®ç´¹ä»‹

[Devise](https://github.com/heartcombo/devise)ã«å¯¾ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…æ©Ÿèƒ½ã‚’è¿½åŠ ã§ãã‚‹Gemã§ã™ã€‚

https://github.com/scambra/devise_invitable

æ‹›å¾…ã®æµã‚Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

1. ç®¡ç†è€…ãªã©ãŒãƒ•ã‚©ãƒ¼ãƒ ã‹æ‹›å¾…ã—ãŸã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®Emailã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦é€ä¿¡
1. Emailã‚¢ãƒ‰ãƒ¬ã‚¹å®›ã«æ‹›å¾…ãƒªãƒ³ã‚¯ä»˜ãã®ãƒ¡ãƒ¼ãƒ«ãŒå±Šãã€ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒ•ã‚©ãƒ¼ãƒ ãŒé–‹ã
1. ãƒ•ã‚©ãƒ¼ãƒ ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦é€ä¿¡ã™ã‚‹ã¨ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã¨ãªã‚‹

## å‰æ

æ—¢ã«DeviseãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹Railsã‚¢ãƒ—ãƒªã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã®ç’°å¢ƒã§å‹•ä½œç¢ºèªã‚’ã—ã¾ã—ãŸã€‚

- Rails 6.1.4
- Ruby 2.7.3
- devise 4.8.0
- devise_invitable 2.0.5


## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ

**Gemã‚’è¿½åŠ **

ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ã€`bundle install`ã—ã¾ã™ã€‚

```rb:Gemfile
gem 'devise_invitable'
```

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚«ãƒ©ãƒ ç¾¤ã‚’ä½œæˆ**

ä¸‹è¨˜ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚`devise.rb`ã«æ‹›å¾…é–¢ä¿‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒå…¥ã‚‹ã®ã¨ã€`config/locales/devise_invitable.en.yml`ãŒä½œæˆã•ã‚Œã¾ã™ã€‚æ—¥æœ¬èªç”¨ã®ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«ã¯[ã“ã¡ã‚‰](https://github.com/helpyio/helpy/blob/master/config/locales/devise_invitable/devise_invitable.ja.yml)ãªã©ãŒãã®ã¾ã¾ä½¿ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚

```shell
rails generate devise_invitable:install
```

ç¶šã„ã¦ã€DeviseInvitableã‚’ãƒ¢ãƒ‡ãƒ«ã«ç´ä»˜ã‘ã—ã¦ã„ãã¾ã™ã€‚

```shell
rails generate devise_invitable User # ãƒ¢ãƒ‡ãƒ«å
```

Migrationãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã®ã§ã€`rails db:migrate`ã‚’å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚

**Viewã®ä½œæˆ**

ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ç”¨ã®Viewãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®æ™‚ä½œæˆã•ã‚Œã‚‹Viewã¯ä»¥ä¸‹ã§ã™ã€‚

- `app/views/devise/invitations/new.html.erb`: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ç”»é¢
- `app/views/devise/invitations/edit.html.erb`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ç”»é¢

```shell
rails generate devise_invitable:views
```

**Controllerã‚’è¨­å®š**

ä¾‹ãˆã°ç®¡ç†è€…ä»¥å¤–ã¯æ‹›å¾…ã‚’é€ã‚Œãªã„ã‚ˆã†ã«ã—ãŸã„ç­‰ã®åˆ¶å¾¡ã¯ã€`Devise::InvitationsController`ã‚’ç¶™æ‰¿ã™ã‚‹Controllerã‚’ä½œæˆã—ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¨­å®šã‚’åŠ ãˆã‚Œã°å®Ÿç¾ã§ãã¾ã™ã€‚

```rb:app/controllers/users/invitations_controller.rb
class Users::InvitationsController < Devise::InvitationsController
  def update
    if some_condition
      redirect_to root_path
    else
      super
    end
  end
end
```


```rb:routes.rb
devise_for :users, controllers: { invitations: 'users/invitations' }
```

## çµ‚ã‚ã‚Šã«

éå»ã« `/admin` é…ä¸‹ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆç”¨ã®Controllerã‚’ä½œã£ã¦å¼·å¼•ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆæ©Ÿèƒ½ãªã©ã‚’ä½œã£ãŸã“ã¨ãŒã‚ã£ãŸã®ã§ã™ãŒã€ã“ã‚Œã ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ‹›å¾…ã™ã‚‹å´ãŒæ±ºã‚ã¦ä¼ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ã«è‰¯ããªã‹ã£ãŸã®ã§ã€ã“ã®Gemã¯åŠ©ã‹ã‚Šã¾ã—ãŸã€‚
